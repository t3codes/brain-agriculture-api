generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  noQueriesCache = true
}

model User {
  id          Int        @id @default(autoincrement())
  name        String
  email       String     @unique
  password    String
  refreshToken String? 
  producers   Producer[] // O usuáio pode criar vários produtores
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Producer {
  id           Int        @id @default(autoincrement())
  cpfOrCnpj    String     @unique
  name         String
  farms        Farm[]     @relation("ProducerFarms")
  userId       Int       
  user         User       @relation(fields: [userId], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Farm {
  id               Int           @id @default(autoincrement())
  name             String
  city             String
  state            String
  totalArea        Float
  arableArea       Float
  vegetationArea   Float
  producerId       Int
  producer         Producer      @relation(fields: [producerId], references: [id], name: "ProducerFarms")
  plantedCrops     FarmCrop[]    @relation("FarmCrops")
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

model Crop {
  id           Int         @id @default(autoincrement())
  name         String      @unique
  farmCrops    FarmCrop[]  @relation("FarmCrops")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Harvest {
  id           Int         @id @default(autoincrement())
  name         String      @unique
  farmCrops    FarmCrop[]  @relation("FarmCrops")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model FarmCrop {
  id           Int      @id @default(autoincrement())
  farmId       Int
  cropId       Int
  harvestId    Int

  farm         Farm     @relation(fields: [farmId], references: [id], name: "FarmCrops")
  crop         Crop     @relation(fields: [cropId], references: [id], name: "FarmCrops")
  harvest      Harvest  @relation(fields: [harvestId], references: [id], name: "FarmCrops")

  @@unique([farmId, cropId, harvestId])
}
